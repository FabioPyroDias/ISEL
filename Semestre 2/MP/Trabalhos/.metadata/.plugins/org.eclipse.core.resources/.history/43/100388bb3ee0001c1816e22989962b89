package tp4;

import java.io.File;
import java.io.FileOutputStream;

import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import javax.xml.xpath.XPath;
import javax.xml.xpath.XPathConstants;
import javax.xml.xpath.XPathFactory;

import org.w3c.dom.Document;
import org.w3c.dom.Element;
import org.w3c.dom.Node;
import org.w3c.dom.NodeList;

public class SaveSystem {
	
	private static File saveFile;
	
	public static void saveFileInitialization(File saveFile)
	{
		try {

	    	 File inputFile = new File("XML/BaseDados.xml");
	    	 
	         DocumentBuilderFactory dbFactory = DocumentBuilderFactory.newInstance();
	         DocumentBuilder dBuilder = dbFactory.newDocumentBuilder();
	         Document doc = dBuilder.parse(inputFile);
	         System.out.println("Root element :" + doc.getDocumentElement().getNodeName());
	         
	     	 XPath xpath = XPathFactory.newInstance().newXPath();
			 String expression = "/BaseDados/Eventos/*";
			 NodeList nList = (NodeList) xpath.evaluate(expression, doc, XPathConstants.NODESET);
	        
	         Node nNode = nList.item(0);
	         Evento evento = Evento.build(nNode);     
	         if(evento != null) evento.print("");

	
	    	 Festival fNovo = new Festival("Bollywood Music Festival"); 
			
			 Espetaculo e1_1 = new Espetaculo("Suna Hai", "Sines", 500);
			 e1_1.addArtista("Suna Hai");
			 fNovo.addEvento(e1_1);
			
			 Espetaculo e1_2 = new Espetaculo("Rait Zara", "Sines", 400);
			 e1_2.addArtista("Rait Zara");
			 fNovo.addEvento(e1_2);
		
			 if(evento instanceof Festival) {
				
				 Festival festival = (Festival)evento;
				 festival.addEvento(fNovo);
				
				 // root elements
				 Document newDoc = dBuilder.newDocument();
				 Element rootElement = newDoc.createElement("Eventos");
				 
				 rootElement.appendChild(festival.createElement(newDoc));
				 
				 newDoc.appendChild(rootElement);
				 	
				 FileOutputStream output = new FileOutputStream("XML/Eventos.xml");
		         writeXml(newDoc, output);

			 }
	        
	      } catch (Exception e) {
	         e.printStackTrace();
	      }
	}
	
	public static void saveGame()
	{
		
	}
	
}